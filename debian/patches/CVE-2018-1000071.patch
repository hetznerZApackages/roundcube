commit 48417c5fc9f6eb4b90500c09596606d489c700b5
Author: Aleksander Machniak <alec@alec.pl>
Date:   Sun Mar 4 09:14:43 2018 +0100

    Remove default for enigma_pgp_homedir (#6173)
    
    To make the default installation more secure force users to set the folder.
    Added notes that it should be secured or not accessible from the web browser.

---
 plugins/enigma/README                      |   15 +++++++++++++--
 plugins/enigma/config.inc.php.dist         |    4 ++--
 plugins/enigma/home/.htaccess              |    7 -------
 plugins/enigma/lib/enigma_driver_gnupg.php |    2 +-
 4 files changed, 16 insertions(+), 12 deletions(-)

--- a/plugins/enigma/config.inc.php.dist
+++ b/plugins/enigma/config.inc.php.dist
@@ -12,8 +12,8 @@ $config['enigma_smime_driver'] = 'phpssl
 // Enables logging of enigma operations (including Crypt_GPG debug info)
 $config['enigma_debug'] = false;
 
-// Keys directory for all users. Default 'enigma/home'.
-// Must be writeable by PHP process
+// REQUIRED! Keys directory for all users.
+// Must be writeable by PHP process, and not in the web server document root
 $config['enigma_pgp_homedir'] = null;
 
 // Location of gpg binary. By default it will be auto-detected.
--- a/plugins/enigma/home/.htaccess
+++ /dev/null
@@ -1,7 +0,0 @@
-# deny webserver access to this directory
-<ifModule mod_authz_core.c>
-    Require all denied
-</ifModule>
-<ifModule !mod_authz_core.c>
-    Deny from all
-</ifModule>
--- a/plugins/enigma/lib/enigma_driver_gnupg.php
+++ b/plugins/enigma/lib/enigma_driver_gnupg.php
@@ -39,7 +39,7 @@ class enigma_driver_gnupg extends enigma
      */
     function init()
     {
-        $homedir = $this->rc->config->get('enigma_pgp_homedir', INSTALL_PATH . 'plugins/enigma/home');
+        $homedir = $this->rc->config->get('enigma_pgp_homedir');
         $debug   = $this->rc->config->get('enigma_debug');
         $binary  = $this->rc->config->get('enigma_pgp_binary');
         $agent   = $this->rc->config->get('enigma_pgp_agent');
--- a/plugins/enigma/README
+++ b/plugins/enigma/README
@@ -21,8 +21,19 @@ Implemented features:
 + Attaching public keys to email
 
 
-TODO:
------
+INSTALLATION
+------------
+
+1. Rename config.inc.php.dist to config.inc.php.
+2. Create a directory for keys storage that is writeable for the PHP process.
+   This directory should be out of the document root, so it is not accessible
+   from the web browser. Set it's location in $config['enigma_pgp_homedir'].
+3. Make sure GnuPG is installed.
+
+
+TODO
+----
+
 - Handling of big messages with temp files
 - Key info in contact details page (optional)
 - Extended key management:
